(function(){console.log("eBay automation content script loaded on:",window.location.href);let E=!1;function C(t){const s=t.match(/\/dp\/([A-Z0-9]{10})|\/gp\/product\/([A-Z0-9]{10})|\/ASIN\/([A-Z0-9]{10})/i);return s?s[1]||s[2]||s[3]:null}async function S(t){var s,n,l,d;try{const c=C(t);console.log("Fetching Amazon product data for ASIN:",c);const a=await(await fetch(t)).text(),o=new DOMParser().parseFromString(a,"text/html");let e="";const i=o.querySelector("#productTitle");i&&(e=((s=i.textContent)==null?void 0:s.trim())||"");let u="";const v=o.querySelector(".a-price-whole"),x=o.querySelector(".a-price-fraction");v&&(u=((n=v.textContent)==null?void 0:n.trim())||"",x&&(u+=((l=x.textContent)==null?void 0:l.trim())||""),u=u.replace(/[^0-9.]/g,""));let b="";const A=o.querySelector("#bylineInfo");A&&(b=((d=A.textContent)==null?void 0:d.replace(/^(Visit the|Brand:)\s*/i,"").trim())||"");const h=[];o.querySelectorAll("#feature-bullets ul li span.a-list-item").forEach(m=>{var y;const p=(y=m.textContent)==null?void 0:y.trim();p&&p.length>0&&h.push(p)});const w=[];o.querySelectorAll("#altImages img, #main-image, #landingImage").forEach(m=>{const p=m.getAttribute("src")||m.getAttribute("data-old-hires");if(p&&!p.includes("data:image")&&!w.includes(p)){const y=p.replace(/\._.*_\./,"._AC_SL1500_.");w.push(y)}});let f="";return e&&(f+=`${e}

`),b&&(f+=`Brand: ${b}

`),h.length>0&&(f+=`Features:
`,h.forEach(m=>{f+=`• ${m}
`}),f+=`
`),f+=`Amazon ASIN: ${c}
`,f+=`Source: ${t}`,console.log("✓ Extracted Amazon product data:",{title:e,price:u,brand:b,featuresCount:h.length,imagesCount:w.length}),{amazonUrl:t,asin:c||void 0,title:e,description:f,price:u,brand:b,features:h,images:w,imageUrl:w[0]||""}}catch(c){console.error("Error fetching Amazon data:",c);const r=C(t);return{amazonUrl:t,asin:r||void 0,title:`Product ASIN: ${r}`,description:`Amazon ASIN: ${r}
Source: ${t}`}}}async function k(){var s,n;console.log("Looking for Create Listing button..."),await new Promise(l=>setTimeout(l,2e3));const t=[".create-listing-btn > a.fake-btn",".create-listing-btn a.fake-btn",".create-listing-btn a.fake-btn:visited",'a.fake-btn[href*="create"]','a.fake-btn[href*="sell"]','button[type="button"]:contains("Create")','a:contains("Create listing")'];for(const l of t){const d=document.querySelectorAll(l);console.log(`Found ${d.length} elements for selector: ${l}`);for(const c of d){const r=((s=c.textContent)==null?void 0:s.toLowerCase())||"",a=((n=c.href)==null?void 0:n.toLowerCase())||"";if(r.includes("create")||r.includes("list")||a.includes("sell")||a.includes("create"))return console.log("✓ Found Create Listing button, clicking...",c),E=!0,c.click(),!0}}return console.log("Create Listing button not found with any selector"),!1}async function $(t){var g;console.log("Auto-filling eBay form with:",t),await new Promise(o=>setTimeout(o,3e3));const s=((g=t.listType)==null?void 0:g.toUpperCase())||"STANDARD";console.log(`Using ${s}-List mode`);let n=0;const l=['input[name*="title"]','input[id*="title"]','textarea[name*="title"]','input[placeholder*="title" i]',"#listings\\.title",'input[data-testid*="title"]'];for(const o of l){const e=document.querySelector(o);if(e&&e.offsetParent!==null&&t.title){e.focus(),e.value=t.title,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.blur(),console.log("✓ Title filled:",t.title.substring(0,50)+"..."),n++;break}}const d=['textarea[name*="description"]','textarea[id*="description"]','div[contenteditable="true"]','iframe[id*="description"]',"#listings\\.description",'textarea[data-testid*="description"]'];for(const o of d){const e=document.querySelector(o);if(e&&e.offsetParent!==null&&t.description){e.tagName==="TEXTAREA"?(e.focus(),e.value=t.description+`

[${s}-List]`,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.blur()):e.tagName==="DIV"&&(e.focus(),e.innerText=t.description+`

[${s}-List]`,e.dispatchEvent(new Event("input",{bubbles:!0}))),console.log("✓ Description filled"),n++;break}}if(t.price){const o=['input[name*="price"]','input[id*="price"]','input[placeholder*="price" i]','input[type="number"]','input[data-testid*="price"]'];for(const e of o){const i=document.querySelector(e);if(i&&i.offsetParent!==null){i.focus(),i.value=t.price,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),i.blur(),console.log("✓ Price filled:",t.price),n++;break}}}const c=['select[name*="condition"]','select[id*="condition"]','input[name*="condition"][value*="New"]','input[name*="condition"][value="1000"]'];for(const o of c){const e=document.querySelector(o);if(e){if(e.tagName==="SELECT"){const i=e;for(let u=0;u<i.options.length;u++)if(i.options[u].text.toLowerCase().includes("new")){i.selectedIndex=u,i.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✓ Condition set to New"),n++;break}}else e.tagName==="INPUT"&&(e.click(),console.log("✓ Condition set to New"),n++);break}}const r=['input[name*="quantity"]','input[id*="quantity"]','input[placeholder*="quantity" i]'];for(const o of r){const e=document.querySelector(o);if(e&&e.offsetParent!==null){e.focus(),e.value="1",e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.blur(),console.log("✓ Quantity set to 1"),n++;break}}console.log(`✓ eBay form auto-fill complete! Filled ${n} fields (${t.index+1}/${t.total})`);const a=document.createElement("div");a.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #28a745;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    z-index: 999999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `,a.textContent=`✓ Auto-filled ${n} fields with Amazon data!`,document.body.appendChild(a),setTimeout(()=>a.remove(),5e3)}(async function(){console.log("Initializing eBay automation..."),await new Promise(s=>setTimeout(s,1500)),chrome.storage.local.get(["automationInProgress"],async s=>{if(!s.automationInProgress){console.log("No automation in progress");return}if(console.log("Automation in progress!"),(window.location.href.includes("ebay.com/sl/sell")||window.location.href.includes("ebay.com/sell")||window.location.href.includes("selling/listings"))&&!E&&(console.log("On sell page, looking for Create Listing button..."),await k())){console.log("✓ Clicked Create Listing button, waiting for listing form...");return}(window.location.href.includes("ebay.com/sell/create")||window.location.href.includes("ebay.com/list")||E)&&(console.log("On listing creation form, looking for product data..."),chrome.storage.local.get(null,async n=>{for(let l=0;l<100;l++){const d=`pendingProduct_${l}`;if(n[d]&&!n[`processed_${l}`]){const c=n[d];console.log(`Found product data at index ${l}:`,c);const r=await S(c.amazonUrl),a={...c,...r};await $(a),await chrome.storage.local.set({[`processed_${l}`]:!0});const g=n.pendingUrls||[];let o=!0;for(let e=0;e<g.length;e++)if(!n[`processed_${e}`]){o=!1;break}if(o){console.log("All products processed, cleaning up...");const e=["automationInProgress","pendingUrls","automationType"];for(let i=0;i<g.length;i++)e.push(`pendingProduct_${i}`),e.push(`processed_${i}`);chrome.storage.local.remove(e)}break}}}))})})();
})()
