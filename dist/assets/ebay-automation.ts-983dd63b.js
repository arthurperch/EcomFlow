(function(){console.log("eBay automation content script loaded on:",window.location.href);async function T(){var i,s;console.log("Looking for Create Listing button..."),await new Promise(c=>setTimeout(c,1500));const t=[".create-listing-btn a.fake-btn",".create-listing-btn>a.fake-btn","a.fake-btn",".create-listing-btn a",'a[href*="sell"]','a[href*="create"]','button[type="submit"]'];for(const c of t){const u=document.querySelectorAll(c);console.log(`Checking selector "${c}": found ${u.length} elements`);for(const r of u){const a=((i=r.textContent)==null?void 0:i.toLowerCase())||"",n=((s=r.href)==null?void 0:s.toLowerCase())||"";if(console.log(`  Button text: "${a}", href: "${n}"`),a.includes("create")||a.includes("list")||a.includes("sell")||n.includes("sell")||n.includes("create"))return console.log("✓ Found Create Listing button! Clicking...",r),r.click(),await chrome.storage.local.set({justClickedCreateButton:!0}),!0}}return console.log("⚠ Create Listing button not found with any selector"),!1}function P(t){const i=t.match(/\/dp\/([A-Z0-9]{10})|\/gp\/product\/([A-Z0-9]{10})|\/ASIN\/([A-Z0-9]{10})/i);return i?i[1]||i[2]||i[3]:null}async function B(t){var i,s,c,u,r,a,n,o,l,e,p,$,S;try{const m=P(t);console.log("Fetching Amazon product data for ASIN:",m);const g=await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!g.ok)throw new Error(`Failed to fetch Amazon page: ${g.status}`);const q=await g.text(),d=new DOMParser().parseFromString(q,"text/html");let w=((s=(i=d.querySelector("#productTitle"))==null?void 0:i.textContent)==null?void 0:s.trim())||"";w||(w=((u=(c=d.querySelector("h1.a-size-large"))==null?void 0:c.textContent)==null?void 0:u.trim())||"");let v="";const k=((a=(r=d.querySelector(".a-price-whole"))==null?void 0:r.textContent)==null?void 0:a.trim())||"",I=((o=(n=d.querySelector(".a-price-fraction"))==null?void 0:n.textContent)==null?void 0:o.trim())||"";k?v=`$${k}${I}`:v=((e=(l=d.querySelector(".a-price .a-offscreen"))==null?void 0:l.textContent)==null?void 0:e.trim())||"";const x=(($=(p=d.querySelector("#bylineInfo"))==null?void 0:p.textContent)==null?void 0:$.trim().replace("Visit the ","").replace(" Store",""))||"",h=[];d.querySelectorAll("#feature-bullets ul li span").forEach(y=>{var E;const f=(E=y.textContent)==null?void 0:E.trim();f&&f.length>5&&h.push(f)});const b=[];d.querySelectorAll("#altImages img").forEach(y=>{const f=y.src;if(f&&!f.includes("play-icon")&&!f.includes("video")){const E=f.replace(/\._.*?_\./,".");b.push(E)}});const A=((S=d.querySelector("#landingImage, #imgBlkFront"))==null?void 0:S.getAttribute("src"))||"";A&&!b.includes(A)&&b.unshift(A);let C="";return x&&(C+=`Brand: ${x}

`),h.length>0&&(C+=`Features:
`+h.map(y=>`• ${y}`).join(`
`)),console.log("✓ Fetched Amazon data:",{title:w,price:v,brand:x,features:h.length,images:b.length}),{amazonUrl:t,asin:m||void 0,title:w||`Product ${m}`,description:C||`Amazon product ${m}`,price:v,brand:x,features:h,images:b.slice(0,10),imageUrl:b[0]||""}}catch(m){console.error("Error fetching Amazon data:",m);const g=P(t);return{amazonUrl:t,asin:g||void 0,title:`Product from Amazon ${g||""}`,description:`Amazon ASIN: ${g}
Source: ${t}`,price:"",imageUrl:""}}}async function F(t){var a;console.log("Starting auto-fill with product:",t),await new Promise(n=>setTimeout(n,3e3));const i=((a=t.listType)==null?void 0:a.toUpperCase())||"STANDARD";console.log(`Using ${i}-List mode`);let s=0;if(t.title){const n=['input[name*="title"]','input[id*="title"]','textarea[name*="title"]','input[placeholder*="title" i]',"#listings\\.title",'[data-testid="title-input"]'];for(const o of n){const l=document.querySelector(o);if(l&&l.offsetParent!==null){l.focus(),l.value=t.title,l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})),l.dispatchEvent(new Event("blur",{bubbles:!0})),console.log("✓ Title filled:",t.title),s++;break}}}if(t.description){const n=['textarea[name*="description"]','textarea[id*="description"]','div[contenteditable="true"]','[data-testid="description-textarea"]',"#listings\\.description"];let o=t.description;t.price&&(o=`Price: ${t.price}

${o}`),o+=`

---
[${i}-List] Source: ${t.amazonUrl}`,t.asin&&(o+=`
ASIN: ${t.asin}`);for(const l of n){const e=document.querySelector(l);if(e&&e.offsetParent!==null){e.focus(),e.tagName==="TEXTAREA"?(e.value=o,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))):e.contentEditable==="true"&&(e.innerText=o,e.dispatchEvent(new Event("input",{bubbles:!0}))),e.dispatchEvent(new Event("blur",{bubbles:!0})),console.log("✓ Description filled"),s++;break}}}if(t.price){const n=t.price.replace(/[^0-9.]/g,""),o=['input[name*="price"]','input[id*="price"]','input[placeholder*="price" i]','[data-testid="price-input"]'];for(const l of o){const e=document.querySelector(l);if(e&&e.offsetParent!==null){e.focus(),e.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),console.log("✓ Price filled:",n),s++;break}}}await new Promise(n=>setTimeout(n,500));const c=['select[name*="condition"]','select[id*="condition"]','[data-testid="condition-select"]'];for(const n of c){const o=document.querySelector(n);if(o&&o.offsetParent!==null){const l=Array.from(o.options).find(e=>e.text.toLowerCase().includes("new"));l&&(o.value=l.value,o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✓ Condition set to: New"),s++);break}}const u=['input[name*="quantity"]','input[id*="quantity"]','[data-testid="quantity-input"]'];for(const n of u){const o=document.querySelector(n);if(o&&o.offsetParent!==null){o.focus(),o.value="1",o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✓ Quantity set to: 1"),s++;break}}console.log(`✓ eBay form auto-fill complete (${t.index+1}/${t.total}) - ${s} fields filled`);const r=document.createElement("div");r.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 999999;
    font-size: 16px;
    font-family: Arial, sans-serif;
  `,r.textContent=`✓ Auto-filled ${s} fields from Amazon (${t.index+1}/${t.total})`,document.body.appendChild(r),setTimeout(()=>r.remove(),5e3)}(async function(){if(console.log("Initializing eBay automation..."),(window.location.href.includes("ebay.com/help/selling")||window.location.href.includes("ebay.com/sell/start")||document.querySelector(".create-listing-btn"))&&chrome.storage.local.get(["automationInProgress","justClickedCreateButton"],async i=>{if(i.automationInProgress&&!i.justClickedCreateButton){console.log("On eBay start page, attempting to click Create Listing button..."),await T()&&console.log("✓ Button clicked, waiting for next page...");return}}),!window.location.href.includes("ebay.com/sell")&&!window.location.href.includes("ebay.com/list")&&!window.location.href.includes("ebay.com/sl/sell")){console.log("Not on eBay listing page, skipping auto-fill");return}console.log("On eBay listing page, checking for pending automation..."),await new Promise(i=>setTimeout(i,2e3)),chrome.storage.local.remove(["justClickedCreateButton"]),chrome.storage.local.get(["automationInProgress","pendingUrls"],async i=>{if(!i.automationInProgress){console.log("No automation in progress");return}console.log("Automation in progress, looking for product data..."),chrome.storage.local.get(null,async s=>{for(let c=0;c<100;c++){const u=`pendingProduct_${c}`;if(s[u]&&!s[`processed_${c}`]){const r=s[u];console.log(`Found product data at index ${c}:`,r),console.log("Fetching Amazon product details...");const a=await B(r.amazonUrl),n={...r,...a};console.log("Full product data ready:",n),await F(n),await chrome.storage.local.set({[`processed_${c}`]:!0});const o=s.pendingUrls||[];let l=!0;for(let e=0;e<o.length;e++)if(!s[`processed_${e}`]){l=!1;break}if(l){console.log("✓ All products processed, cleaning up storage...");const e=["automationInProgress","pendingUrls","automationType"];for(let p=0;p<o.length;p++)e.push(`pendingProduct_${p}`),e.push(`processed_${p}`);chrome.storage.local.remove(e),console.log("✓ Cleanup complete!")}break}}})})})();
})()
